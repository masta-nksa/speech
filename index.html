<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lernprogramm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            text-align: center;
            padding: 20px;
        }

        h1,
        h2 {
            color: #333;
        }

        button {
            font-size: 18px;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #87CEEB;
        }

        .option-btn {
            background-color: #4682B4;
            color: white;
            width: 170px;
        }

        .hidden {
            display: none;
        }

        .home-icon {
            position: absolute;
            top: 20px;
            left: 20px;
            cursor: pointer;
        }

        .error {
            border: 2px solid red;
            background-color: red;
        }

        .home-icon img {
            width: 40px;
            height: 40px;
        }

        .quiz-container {
            margin-top: 50px;
        }

        .word-display {
            font-size: 36px;
            margin: 40px 0;
        }

        .options {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .scoreboard {
            font-size: 20px;
            margin-top: 20px;
        }

        #input-field {
            font-size: 20px;
            padding: 10px;
            margin-top: 20px;
            width: 300px;
            text-align: center;
        }

        #login-screen {

            margin: 0 auto;
            /* Zentriert den Container */
            width: 300px;
            /* Setzt eine feste Breite */
            padding: 20px;
            /* Fügt etwas Innenabstand hinzu */
            background-color: #f0f8ff;
            /* Heller Hintergrund */
            border-radius: 8px;
            /* Abgerundete Ecken */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            /* Schatteneffekt */
        }

        #login-screen h1 {
            margin-bottom: 20px;
            /* Abstand unter der Überschrift */
        }

        #login-screen label {
            display: block;
            /* Label auf eine neue Zeile setzen */
            margin: 10px 0;
            /* Abstand oben und unten */
        }

        #login-screen input {
            width: 90%;
            /* Eingabefelder füllen den Container */
            padding: 10px;
            /* Innenabstand in den Eingabefeldern */
            border: 1px solid #ccc;
            /* Rahmen für Eingabefelder */
            border-radius: 4px;
            /* Abgerundete Ecken für Eingabefelder */
            margin-bottom: 20px;
            /* Abstand unten */
        }

        #login-screen button {
            width: 100%;
            /* Schaltfläche füllt den Container */
            padding: 10px;
            /* Innenabstand in der Schaltfläche */
            background-color: #4682B4;
            /* Hintergrundfarbe für die Schaltfläche */
            color: white;
            /* Textfarbe */
            border: none;
            /* Kein Rahmen */
            border-radius: 4px;
            /* Abgerundete Ecken für die Schaltfläche */
            cursor: pointer;
            /* Zeiger bei Hover */
            transition: background-color 0.3s;
            /* Übergang für Hover-Effekt */
        }

        #login-screen button:hover {
            background-color: #5a9bd4;
            /* Hellerer Farbton bei Hover */
        }

        #csv-print-section_t {


            border: 2px solid #353b35;
            /* Adjust the color as needed */
            padding: 5px;
            /* Adds space inside the border */
            margin: 5px;
            /* Adds space outside the border */
            border-radius: 8px;
            /* Rounded corners */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            /* Optional shadow */
        }

        /* Stil für das Popup */
        .popup {
            display: none;
            /* Standardmäßig versteckt */
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 1px solid #ddd;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            z-index: 1000;
            max-width: 90%;
            /* Maximalbreite des Popups */
            max-height: 80%;
            /* Maximalhöhe des Popups */
            overflow-y: auto;
            /* Ermöglicht das Scrollen innerhalb des Popups */

        }

        /* Stil für den Overlay-Hintergrund */
        .overlay {
            display: none;
            /* Standardmäßig versteckt */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 500;
            overflow-y: auto;
            /* Ermöglicht das Scrollen bei überflüssigem Inhalt */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            /* Gitterlinien zusammenführen */
            margin-top: 20px;
        }

        th,
        td {
            padding: 10px;
            border: 1px solid #ddd;
            /* Gitterlinien für die Zellen */
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>
    <!-- Startbildschirm -->
    <div id="login-screen">
        <h1>Welcome to the Learning Program</h1>
        <div class="input-container">
            <label for="nameInput">Enter your name:</label>
            <input type="text" id="nameInput" placeholder="Your name">
        </div>
        <div class="input-container">
            <label for="pwInput">Enter your password:</label>
            <input type="password" id="pwInput" placeholder="Your password">
        </div>
        <div class="input-container">
            <label for="heroSelect">Choose your favorite Avenger:</label>
            <select id="avengerSelect" onchange="displayAvenger()">
                <option value="" disabled selected>Select an Avenger</option>
                <option value="Iron Man">Iron Man</option> <!-- männlich -->
                <option value="Thor">Thor</option> <!-- männlich -->
                <option value="Hulk">Hulk</option> <!-- männlich -->
                <option value="Black Widow">Black Widow</option> <!-- weiblich -->
                <option value="Captain America">Captain America</option> <!-- weiblich -->
                <option value="Scarlet Witch">Scarlet Witch</option> <!-- weiblich -->
            </select>
        </div>
        <button onclick="chooseLessons()">Start</button>
    </div>
    <!-- Begrüßungsbildschirm -->
    <div id="welcome-screen" class="hidden">
        <h1 id="welcomeMessage"></h1>
    </div>
    <!-- Lernabschnitt (noch verborgen) -->
    <div id="lesson-selection-section" class="hidden">
        <h2>Choose lessons or upload a file</h2>
        <div id="lesson-selection" class="lesson-selection"></div>
        <div id="csv-print-section">
            <h4>Print Vocabulary</h4>
            <input type="radio" name="print_option" value="all" id="print_all">
            <label for="print_all">Everything</label>
            <input type="radio" name="print_option" value="de" id="print_de">
            <label for="print_de">German</label>
            <input type="radio" name="print_option" value="en" id="print_en">
            <label for="print_en">English</label>
            <button onclick="openTableInNewWindow()">Generate printable table</button>
            <!-- Popup-Overlay -->
            <div class="overlay" id="overlay"></div>
            <!-- Popup-Inhalt -->
            <div class="popup" id="popup">
                <h2>Selected Vocabulary</h2>
                <div class="option" id="popupOption"></div>
                <table>
                    <thead>
                        <tr>
                            <th>English</th>
                            <th>Deutsch</th>
                            <th></th> <!-- Leere Spalte -->
                        </tr>
                    </thead>
                    <tbody id="popupTableBody">
                        <!-- Dynamisch generierte Zeilen -->
                    </tbody>
                </table>
                <button onclick="randomizeTable()">Reihenfolge randomisieren</button>
                <button onclick="printTable()">Drucken</button>
                <button onclick="closePopup()">Schließen</button>
            </div>

            <div id="csv-upload-section">
                <h2>csv-fileupload</h2>
                <input type="file" id="csvFileInput" accept=".csv" onchange="loadCSVFile(event)">
            </div>

            <button class="option-btn" onclick="startQuiz()">terms</button>
            <button class="option-btn" onclick="startLearning()">spelling</button>
            <button class="option-btn" onclick="startWriting()">writing</button>
        </div>
    </div>
    <h1 id="headerText"></h1>
    <div id="mode-selection-section" class="hidden">
        <button class="option-btn" onclick="startQuiz()">terms</button>
        <button class="option-btn" onclick="startLearning()">spelling</button>
        <button class="option-btn" onclick="startWriting()">writing</button>
    </div>

    <div class="home-icon" onclick="goToHome()">
        <img src="https://img.icons8.com/ios-filled/50/000000/home.png" alt="Home">
    </div>







    <div id="quiz-section" class="hidden">
        <h2>find the term</h2>
        <div class="quiz-container">
            <div id="word-display" class="word-display"></div>
            <div id="options" class="options"></div>
        </div>
    </div>

    <div id="learning-section" class="hidden">
        <h2>leaning</h2>
        <div class="quiz-container">
            <div id="german-word-display" class="word-display"></div>
            <div id="learning-options" class="options"></div>
        </div>
    </div>

    <div id="writing-section" class="hidden">
        <h2>writing</h2>
        <div class="quiz-container">
            <div id="german-word-writing" class="word-display"></div>
            <input type="text" id="input-field" placeholder="Englische Übersetzung eingeben"
                onkeydown="if (event.key === 'Enter') { event.preventDefault(); checkInput(); }">
            <button class="option-btn" onclick="checkInput()">Überprüfen</button>
        </div>
    </div>
    <div id="scoreboard" class="scoreboard"></div>
    <div id="selectedAvenger" style="position: absolute; top: 20px; right: 20px; text-align: center;">
        <img id="avengerImage" src="" alt="" style="display: none; width: 100px; height: auto;">
        <p id="avengerName" style="font-size: 18px; color: #333;"></p>
    </div>
    <script>
        let data = [];
        let selectedLessons = [];
        let currentDataset = [];
        let currentIndex = 0;
        let correctAnswersCount = 0;
        let wrongAnswersCount = 0;
        let wrongAnswersLearningCount = 0;

        function randomizeTable() {
            const tableBody = document.getElementById('popupTableBody');
            const rows = Array.from(tableBody.rows);

            // Mischen der Zeilen
            for (let i = rows.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                tableBody.appendChild(rows[j]); // Verschiebe die zufällig ausgewählte Zeile an das Ende
            }
        }
        function openPopup(selectedData) {
            const tbody = document.getElementById('popupTableBody');
            tbody.innerHTML = ''; // Vorherige Zeilen löschen

            // Druckoptionen ermitteln
            const printOption = document.querySelector('input[name="print_option"]:checked').value;

            selectedData.forEach(row => {
                const tr = document.createElement('tr');

                if (printOption === 'all') {
                    // Englische und deutsche Spalten mit leerer Spalte
                    tr.innerHTML = `
                <td>${row.English}</td>
                <td>${row.Deutsch}</td>
            `;
                } else if (printOption === 'de') {
                    // Nur die deutsche Spalte mit leerer Spalte
                    tr.innerHTML = `
                <td>${row.Deutsch}</td>
                        <td width="70%"></td>
            `;
                } else if (printOption === 'en') {
                    // Nur die englische Spalte mit leerer Spalte
                    tr.innerHTML = `
                <td>${row.English}</td>
                <td width="70%"></td>
            `;
                }

                tbody.appendChild(tr);
            });

            document.getElementById('overlay').style.display = 'block';
            document.getElementById('popup').style.display = 'block';
        }
        function printTable() {
            const popup = document.getElementById('popup');
            const popupContent = popup.innerHTML;

            // Temporäres CSS für den Druck erstellen
            const originalContent = document.body.innerHTML;
            document.body.innerHTML = `
        <div style="text-align: center;">
            <h2>Selected Vocabulary</h2>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th>English</th>
                        <th>Deutsch</th>
                    </tr>
                </thead>
                <tbody>
                    ${document.getElementById('popupTableBody').innerHTML}
                </tbody>
            </table>
        </div>
    `;

            window.print(); // Druckdialog aufrufen
            document.body.innerHTML = originalContent; // Ursprünglichen Inhalt wiederherstellen
            closePopup(); // Popup schließen
        }


        function closePopup() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('popup').style.display = 'none';
        }

        function openTableInNewWindow() {
            const selectedLessons = Array.from(document.querySelectorAll('#lesson-selection input:checked'))
                .map(checkbox => checkbox.value);
            const selectedData = data.filter(item => selectedLessons.includes(item.Lesson));

            if (selectedData.length === 0) {
                alert("Bitte wähle mindestens eine Lektion aus, um die Tabelle anzuzeigen.");
                return;
            }

            const selectedOption = document.querySelector('input[name="options"]:checked');

            // Popup öffnen
            openPopup(selectedData);
        }

        const avengerImages = {
            "Iron Man": "./img/ironman.gif",
            "Captain America": "./img/captainamerica.gif",
            "Thor": "./img/thor.gif",
            "Hulk": "./img/hulk.gif",
            "Black Widow": "./img/black.gif",
            "Scarlet Witch": "./img/scarlet.gif"
        };

        let callCount = 0;

        function displayAvenger() {
            const avengerSelect = document.getElementById('avengerSelect');
            const avengerImage = document.getElementById('avengerImage');
            const avengerName = document.getElementById('avengerName');

            const selectedAvenger = avengerSelect.value;

            if (selectedAvenger) {
                avengerImage.src = avengerImages[selectedAvenger];
                avengerImage.alt = selectedAvenger;
                avengerImage.style.display = "block";


                blurInit(50);

            } else {
                avengerImage.style.display = "none";
                avengerName.innerText = '';
            }
        }


        let currentBlur = 0;
        const maxBlur = 40;
        const steps = 20;
        const blurStep = maxBlur / steps; // Blur-Wert, der bei jedem Schritt abnimmt

        function blurInit(startBlur) {
            currentBlur = Math.min(startBlur, maxBlur);
            avengerImage.style.filter = `blur(${currentBlur}px)`;
        }

        function increaseBlur() {
                currentBlur += blurStep; // Erhöhe den Blur um den festgelegten Schrittwert
                avengerImage.style.filter = `blur(${currentBlur}px)`;
        }

        function decreaseBlur() {
            if (currentBlur > 0) {
                currentBlur -= blurStep; // Reduziere den Blur um den festgelegten Schrittwert
                avengerImage.style.filter = `blur(${currentBlur}px)`;
                //requestAnimationFrame(decreaseBlur); // Nächster Frame für sanften Effekt
            } else {
                avengerImage.style.filter = "none"; // Setze den Blur auf 0 für das Originalbild
            }
        }

        function loadDefaultCSV() {
            fetch("lessons.csv")
                .then(response => {
                    if (!response.ok) throw new Error("Standard-CSV-Datei konnte nicht geladen werden.");
                    return response.text();
                })
                .then(text => {
                    data = parseCSV(text);
                    showLessonSelection();
                })
                .catch(error => console.error(error.message));
        }

        function loadCSVFile(event) {
            const fileInput = document.getElementById('csvFileInput');
            const file = fileInput.files[0];
            const reader = new FileReader();

            if (!file) {
                alert('Choose a csv-file.');
                return;
            }

            reader.onload = (e) => {
                data = parseCSV(e.target.result);
                showLessonSelection();
            };

            reader.readAsText(file);
        }

        function parseCSV(text) {
            return text.trim().split('\n').slice(1).map(row => {
                const [Lesson, English, Deutsch] = row.split(';');
                return { Lesson, English, Deutsch };
            });
        }

        function chooseLessons() {
            const name = document.getElementById("nameInput").value.trim();
            if (true) {  //name
                document.getElementById("login-screen").classList.add("hidden");
                document.getElementById("welcome-screen").classList.remove("hidden");
                document.getElementById("welcomeMessage").innerText = `Hello ${name}, let's learn some English words!`;
                loadDefaultCSV();
            } else {
                alert("Please enter a name.");
            }

        }
        function startLearning() {
            const name = document.getElementById("nameInput").value.trim();
            if (name) {
                document.getElementById("login-screen").classList.add("hidden");
                document.getElementById("welcome-screen").classList.remove("hidden");
                document.getElementById("welcomeMessage").innerText = `Hello ${name}, let's learn some English words!`;
            } else {
                alert("Please enter a name.");
            }
        }





        function showLessonSelection() {
            document.getElementById('lesson-selection-section').classList.remove('hidden');
            const lessons = [...new Set(data.map(item => item.Lesson))];
            displayLessonSelection(lessons);
        }

        function displayLessonSelection(lessons) {
            const lessonSelectionDiv = document.getElementById('lesson-selection');
            lessonSelectionDiv.innerHTML = '';

            lessons.forEach(lesson => {
                lessonSelectionDiv.innerHTML += `
    <input type="checkbox" value="${lesson}" id="${lesson}">
    <label for="${lesson}">${lesson}</label><br>
    `;
            });
        }

        function hideHeaderText() {
            document.getElementById('headerText').classList.add('hidden');
        }

        function startQuiz() {
            hideHeaderText();
            setupQuiz('quiz-section');
        }

        function startLearning() {
            hideHeaderText();
            setupQuiz('learning-section');
        }

        function startWriting() {
            hideHeaderText();
            setupQuiz('writing-section');
        }

        function setupQuiz(section) {
            selectedLessons = Array.from(document.querySelectorAll('#lesson-selection input:checked'))
                .map(checkbox => checkbox.value);
            currentDataset = data.filter(item => selectedLessons.includes(item.Lesson));

            if (currentDataset.length > 0) {
                document.getElementById('lesson-selection-section').classList.add('hidden');
                document.getElementById(section).classList.remove('hidden');
                currentIndex = 0;
                correctAnswersCount = 0;
                wrongAnswersCount = 0;
                wrongAnswersLearningCount = 0;

                if (section === 'quiz-section') {
                    showNextWord();
                } else if (section === 'learning-section') {
                    showNextLearningWord();
                } else if (section === 'writing-section') {
                    showNextWritingWord();
                }
            } else {
                alert('Bitte wähle mindestens eine Lektion aus.');
            }
        }

        function generateVariations(correctAnswer) {
            const variations = [];
            const letters = correctAnswer.split('');

            // Variation 1: Remove a random letter
            const variation1 = correctAnswer.slice(0, Math.floor(Math.random() * letters.length)) +
                correctAnswer.slice(Math.floor(Math.random() * letters.length) + 1);
            variations.push(variation1);

            // Variation 2: Swap two adjacent letters
            const index = Math.floor(Math.random() * (letters.length - 1));
            const variation2 = letters.slice();
            [variation2[index], variation2[index + 1]] = [variation2[index + 1], variation2[index]];
            variations.push(variation2.join(''));

            // Variation 3: Füge einen zusätzlichen zufälligen Kleinbuchstaben an einer zufälligen Stelle im Wort ein
            const randomLetter = String.fromCharCode(97 + Math.floor(Math.random() * 26));
            const insertPosition = Math.floor(Math.random() * (correctAnswer.length + 1)); // Stelle bestimmen
            const variation3 = correctAnswer.slice(0, insertPosition) + randomLetter + correctAnswer.slice(insertPosition);
            variations.push(variation3);

            return variations;
        }


        function showNextWord() {
            if (currentIndex >= currentDataset.length) {
                alert(`Quiz beendet! Richtig: ${correctAnswersCount}, Falsch: ${wrongAnswersCount}`);
                return;
            }

            const currentWord = currentDataset[currentIndex];
            document.getElementById('word-display').innerText = currentWord.English;
            speakText(currentWord.English);

            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';
            const allOptions = shuffleArray([currentWord.Deutsch, ...getRandomWrongAnswers(currentWord.Deutsch)]);
            allOptions.forEach(option => createOptionButton(option, currentWord.Deutsch, optionsDiv));

            updateScoreboard();
        }

        function createOptionButton(option, correctAnswer, optionsDiv) {
            const btn = document.createElement('button');
            btn.classList.add('option-btn');
            btn.innerText = option;
            btn.onclick = () => {
                option === correctAnswer ? (correctAnswersCount++, decreaseBlur()) : (wrongAnswersCount++, increaseBlur(),increaseBlur(),increaseBlur());
                currentIndex++;
                updateScoreboard();
                showNextWord();
            };
            optionsDiv.appendChild(btn);
        }

        function getRandomWrongAnswers(correctAnswer) {
            const wrongAnswers = data.filter(item => item.Deutsch !== correctAnswer).map(item => item.Deutsch);
            return shuffleArray(wrongAnswers).slice(0, 3);
        }

        function showNextWritingWord() {
            if (currentIndex >= currentDataset.length) {
                alert(`Schreiben beendet! Richtig: ${correctAnswersCount}, Falsch: ${wrongAnswersCount}`);
                return;
            }

            const currentWord = currentDataset[currentIndex];
            document.getElementById('german-word-writing').innerText = currentWord.Deutsch;
            document.getElementById('input-field').value = '';
            updateScoreboard();
        }

        let attemptCount = 0; // Zähler für Fehlversuche

        function checkInput() {
            const inputField = document.getElementById('input-field');
            const input = inputField.value.trim();
            const correctAnswer = currentDataset[currentIndex].English;

            if (input === correctAnswer) {
                speakText(correctAnswer);
                correctAnswersCount++;
                decreaseBlur();
                attemptCount = 0; // Zurücksetzen bei richtiger Antwort
                currentIndex++;
                inputField.classList.remove('error')
                showNextWritingWord();
            } else {
                speakText(correctAnswer);
                wrongAnswersCount++;
                attemptCount++;
                increaseBlur();
                increaseBlur();
                increaseBlur();
                // Rahmen rot aufleuchten lassen
                inputField.classList.add('error');
                setTimeout(() => inputField.classList.remove('error'), 500);
                if (attemptCount >= 2) {
                    inputField.value = correctAnswer; // Korrekte Antwort anzeigen
                    attemptCount = 0; // Zurücksetzen für das nächste Wort
                    currentIndex++;
                    setTimeout(showNextWritingWord, 2500); // Weiter nach 2 Sekunden
                }
            }
        }

        function showNextLearningWord() {
            if (currentIndex >= currentDataset.length) {
                alert(`Lernen beendet! Richtig: ${correctAnswersCount}, Falsch: ${wrongAnswersCount}, Falsch im Lernen:
    ${wrongAnswersLearningCount}`);
                return;
            }

            const currentWord = currentDataset[currentIndex];
            const germanWordDisplay = document.getElementById('german-word-display');
            germanWordDisplay.innerText = currentWord.Deutsch;

            const correctAnswer = currentWord.English;
            const variations = generateVariations(correctAnswer);

            const optionsDiv = document.getElementById('learning-options');
            optionsDiv.innerHTML = '';

            const allOptions = [correctAnswer, ...variations];
            shuffleArray(allOptions);

            allOptions.forEach(option => {
                const btn = document.createElement('button');
                btn.classList.add('option-btn');
                btn.innerText = option;
                btn.onclick = function () {
                    speakText(option);
                    if (option === correctAnswer) {
                        currentIndex++;
                        correctAnswersCount++
                        decreaseBlur();
                        updateScoreboard();
                        showNextLearningWord();

                    } else {
                        wrongAnswersCount++;
                        increaseBlur();
                        increaseBlur();
                        increaseBlur();
                        updateScoreboard();
                    }
                };
                optionsDiv.appendChild(btn);
            });

            updateScoreboard();
        }


        function updateScoreboard() {
            document.getElementById('scoreboard').innerText = `correct: ${correctAnswersCount} | false: ${wrongAnswersCount} |
    remaining questions: ${currentDataset.length - currentIndex}`;
        }
        function clearScoreboard() {
            document.getElementById('scoreboard').innerText = ``;
        }


        function speakText(text) {
            const speech = new SpeechSynthesisUtterance();
            speech.lang = 'en-US'; // Sprache einstellen
            speech.text = text;
            speech.onerror = (event) => console.error("Fehler beim Sprechen:", event);
            speechSynthesis.cancel(); // Alle laufenden Ausgaben stoppen
            speechSynthesis.speak(speech);
        }

        function shuffleArray(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function goToHome() {
            // Blende alle anderen Abschnitte aus
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('learning-section').classList.add('hidden');
            document.getElementById('writing-section').classList.add('hidden');

            document.getElementById('lesson-selection-section').classList.remove('hidden');

            // Zeige den CSV-Upload-Bereich und den Header-Text an

            clearScoreboard();
        }



    </script>

</body>

</html>